---
title: "Manual para uma consultoria" 
author: "Estats Consultoria"
date: "`r Sys.Date()`"
fontsize: 20pt
output: 
  html_document:
    toc: true
    toc_depth: 2
    toc_float: True
    theme: simplex
linestretch: 1.5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```

<style>
  body{
    text-align: justify;
    font-size: 16px
    }
  h4 {font-size:20px}
  h5 {font-size:18px}
  strong {fontsize:16px}
</style>

# 1. Introdução

Escrever o objetivo desse curso/material (preparar pra realizar consultorias), escrever também dos passos que serão tratados e deixar o link de uma consultoria pronta no drive.

# 2. Tratamento de dados

Colocar o processo de tratamento de dados que conversamos nos offices, dando exemplos com imagens e exemplos de problemas.

# 2.1. Excel

# 2.2. R

# 3. Descritiva

Colocar o processo da descritiva que conversamos, com exemplos e problemas.

## 3.1. Gráficos no ggplot2

### Pacotes
```{r Pacotes}
library(ggplot2)
library(dplyr)
library(gridExtra)
library(forcats)

pct_format = scales::percent_format(accuracy = .1)

```


### Gráfico de barras univariado
```{r barras univariado}
uni_bar <- function(banco, var, ylab= 'Frequência', xlab = '', color = '#767F8B', order = NULL, flip = F){
  
  banco <- banco[banco[var] != '',][var]
  
  if(typeof(banco[3,var]) == 'character')
  {  
    prim.maiuscula <- function(x) {
      x <- tolower(x)
      substr(x, 1, 1) <- toupper(substr(x, 1, 1))
      x
    }
    
    banco[var] <- sapply(banco[var], FUN = prim.maiuscula)
  }
  if(!is.null(order))
  {banco[var] <- fct_relevel(factor((banco[[var]]), levels=order))}
  banco <- data.frame(table(banco[var]))
  names(banco)[1] <- var
  
  
  if(flip == F)
  { ax <- ggplot(banco, aes(x = .data[[var]], y = Freq)) + 
    geom_bar(fill=color, stat='identity') + 
    theme_minimal()+
    labs(x= xlab, y = 'Frequência') + 
    ylim(0.0, max(banco$Freq)*1.05)+
    geom_label(aes(
      label = sprintf(
        '%d (%s)',
        Freq,
        pct_format(Freq / sum(Freq))
      )), stat='identity', fill='white', vjust=1.2, label.size = 0.25)}
  else if(flip == T)
  { ax <- ggplot(banco, aes(x = .data[[var]], y = Freq)) + 
    geom_bar(fill=color, stat='identity') + 
    theme_minimal() +
    labs(x= xlab, y = 'Frequência') +
    ylim(0.0, max(banco$Freq)*1.05)+
    geom_label(aes(
      label = sprintf(
        '%d (%s)',
        Freq,
        pct_format(Freq / sum(Freq))
      )), stat='identity', fill='white', label.size = 0.25)+
    coord_flip()}
  
  print(ax)
  
  arquivo <- paste0('img/uni/', var, '.pdf')
  ggsave(arquivo)

  
}

```

### Gráfico de barras bivariado

```{r Barras bivariado}
bi_bar <- function(banco, x, y, ylab= 'Frequência', xlab = '', label_fill = '', color = c('#767F8B', '#B3B7B8'), label_size = 0.25, order = NULL, flip = F){
  
  banco <- banco[banco[x] != '' & banco[y] != '',][,c(x,y)]
  prim.maiuscula <- function(x) {
    x <- tolower(x)
    substr(x, 1, 1) <- toupper(substr(x, 1, 1))
    x
  }
  
  if(typeof(banco[3,x]) == 'character') {banco[x] <- sapply(banco[x], FUN = prim.maiuscula)}
  if(typeof(banco[3,y]) == 'character') {banco[y] <- sapply(banco[y], FUN = prim.maiuscula)}
  
  if(!is.null(order))
  {banco[x] <- fct_relevel(factor((banco[[x]]), levels=order))}
  banco <- data.frame(table(banco))
  names(banco) <- c(x, y, 'Freq')
  
  
  if(flip == F)
  { 
      ax <- ggplot(banco, aes(x = .data[[x]], y = Freq, fill = .data[[y]])) + 
      geom_bar( stat='identity', position =  "dodge") + 
      theme_minimal()+
      labs(x= xlab, y = 'Frequência', fill = label_fill) + 
      ylim(0.0, max(banco$Freq)*1.05)+
      geom_label(aes(
        label = sprintf(
          '%d (%s)',
          Freq,
          pct_format((Freq / sum(Freq)))
        ), group = y), position = position_dodge2(width = 0.9),
        size=2.5,col = "black", fill='white')+
      scale_fill_manual(values=color)+
      theme_minimal()
    
  }
    
  else if(flip == T)
  {     ax <- ggplot(banco, aes(x = .data[[x]], y = Freq, fill = .data[[y]])) + 
    geom_bar( stat='identity', position =  "dodge") + 
    theme_minimal()+
    labs(x= xlab, y = 'Frequência', fill = label_fill) + 
    ylim(0.0, max(banco$Freq)*1.05)+
    geom_label(aes(
      label = sprintf(
        '%d (%s)',
        Freq,
        pct_format((Freq / sum(Freq)))
      ), group = y), position = position_dodge2(width = 0.9, ),
      size=2.5,hjust= 0.5, col = "black", fill='white')+
    scale_fill_manual(values=color,)+
    theme_minimal()+
    coord_flip()+
    guides(fill = guide_legend(reverse = TRUE))}
  
  print(ax)
  
  arquivo <- paste0('img/bi/', x, 'X', y, '.pdf')
  ggsave(arquivo, dpi = 500)
  
  
}
```

### Boxplot

```{r boxplot}
uni_boxplot <- function(banco, var, xlab= '', ylab = '', color = '#767F8B', flip = F){
  
  banco <- banco[banco[var] != '',][var]
  
  if(typeof(banco[3,var]) == 'character')
  {  
    prim.maiuscula <- function(x) {
      x <- tolower(x)
      substr(x, 1, 1) <- toupper(substr(x, 1, 1))
      x
    }
    
    banco[var] <- sapply(banco[var], FUN = prim.maiuscula)
  }
  
  if(flip == F)
  { 
    ax <- ggplot(banco, aes(x = '', y = .data[[var]])) + 
    stat_boxplot(geom='errorbar', linetype=1, width=0.25)+
    geom_boxplot(fill = color) +
    theme_minimal()+
    labs(x= xlab, y = ylab) }
    
  else if(flip == T)
  {     
    ax <- ggplot(banco, aes(x = '', y = .data[[var]])) + 
    stat_boxplot(geom='errorbar', linetype=1, width=0.25)+
    geom_boxplot(fill = color) +
    theme_minimal()+
    labs(x= xlab, y = ylab) +
    coord_flip() }
  
  print(ax)
  
  arquivo <- paste0('img/uni/', var, '.pdf')
  ggsave(arquivo)
  
}
```


### Boxplot bivariado

```{r boxplot bivariado}
bi_boxplot <- function(banco, x, y, xlab= '', ylab = '', color = '#767F8B', flip = F){
  
  banco <- banco[!is.na(banco[x]) & !is.na(banco[y]),][,c(x,y)]
  
  prim.maiuscula <- function(x) {
    x <- tolower(x)
    substr(x, 1, 1) <- toupper(substr(x, 1, 1))
    x
  }
  
  if(typeof(banco[3,x]) == 'character') {banco[x] <- sapply(banco[x], FUN = prim.maiuscula)}
  if(typeof(banco[3,y]) == 'character') {banco[y] <- sapply(banco[y], FUN = prim.maiuscula)}
  
  if(flip == F)
  { 
    ax <- ggplot(banco, aes(x = .data[[x]], y = .data[[y]])) + 
      stat_boxplot(geom='errorbar', linetype=1, width=0.25)+
      geom_boxplot(fill = color) +
      theme_minimal()+
      labs(x= xlab, y = ylab) }
  
  else if(flip == T)
  {     
    ax <- ggplot(banco, aes(x = .data[[x]], y = .data[[y]])) + 
      stat_boxplot(geom='errorbar', linetype=1, width=0.25)+
      geom_boxplot(fill = color) +
      theme_minimal()+
      labs(x= xlab, y = ylab) +
      coord_flip() }
  
  print(ax)
  
  arquivo <- paste0('img/bi/', x, 'X', y, '.pdf')
  ggsave(arquivo)
  
}

```

### Histograma

```{r histograma}
histograma <- function(banco, var, xlab= '', ylab = 'Frequência', color = '#767F8B', media = T){
  
  banco <- banco[banco[var] != '',][var]
  
  
  if(media == T){
    ax <- ggplot(banco, aes(x = .data[[var]])) + 
      geom_histogram(col = 'black',
                     fill = color,
                     alpha = 0.9)+
      geom_vline(xintercept = mean(banco[[var]], na.rm = T),
                 color = 'red', linetype = 'dashed', lwd = 1.2)+
      theme_minimal()+
      labs(x= xlab, y = ylab) 
  }
  else if(media == F){
    ax <- ggplot(banco, aes(x = .data[[var]])) + 
      geom_histogram(col = 'black',
                     fill = color,
                     alpha = 0.9)+
      theme_minimal()+
      labs(x= xlab, y = ylab) 
  }
    
  print(ax)
  
  arquivo <- paste0('img/uni/', var, '.pdf')
  ggsave(arquivo)
}

bi_bar2 <- function(banco, x, y, ylab= 'Frequência', xlab = '', label_fill = '', color = c('#767F8B', '#B3B7B8'), label_size = 0.25, flip = F,order = NULL, order_fill = NULL){
  
  banco <- banco[banco[x] != '' & banco[y] != '',][,c(x,y)]
  prim.maiuscula <- function(x) {
    x <- tolower(x)
    substr(x, 1, 1) <- toupper(substr(x, 1, 1))
    x
  }
  
  if(typeof(banco[3,x]) == 'character') {banco[x] <- sapply(banco[x], FUN = prim.maiuscula)}
  if(typeof(banco[3,y]) == 'character') {banco[y] <- sapply(banco[y], FUN = prim.maiuscula)}
  
  if(!is.null(order))
  {banco[x] <- fct_relevel(factor((banco[[x]]), levels=order))}
  
  if(!is.null(order_fill))
  {banco[y] <- fct_relevel(factor((banco[[y]]), levels=order_fill))}
  
  banco <- data.frame(table(banco))
  names(banco) <- c(x, y, 'Freq')
  
  if(flip == F)
  { 
    ax <- ggplot(banco, aes(x = .data[[x]], y = Freq, fill = .data[[y]])) + 
      geom_bar( stat='identity', position =  "dodge") + 
      theme_minimal()+
      labs(x= xlab, y = 'Frequência', fill = label_fill) + 
      ylim(0.0, max(banco$Freq)*1.05)+
      geom_label(aes(
        label = sprintf(
          '%d (%s)',
          Freq,
          pct_format((Freq / sum(Freq)))
        ), group = y), position = position_dodge2(width = 0.9),
        size=2.5,col = "black", fill='white')+
      scale_fill_manual(values=color)+
      theme_minimal()
    
  }
  else if(flip == T)
  {     ax <- ggplot(banco, aes(x = .data[[x]], y = Freq, fill =.data[[y]])) + 
    geom_bar( stat='identity', position =  "dodge") + 
    theme_minimal()+
    labs(x= xlab, y = 'Frequência', fill = label_fill) + 
    ylim(0.0, max(banco$Freq)*1.05)+
    geom_label(aes(
      label = sprintf(
        '%d (%s)',
        Freq,
        pct_format((Freq / sum(Freq)))
      ), group = y), position = position_dodge2(width = 0.9, ),
      size=2.5,hjust= 0.5, col = "black", fill='white')+
    scale_fill_manual(values=color,)+
    theme_minimal()+
    coord_flip()+
    guides(fill = guide_legend(reverse = TRUE))}
  
  print(ax)
  
  arquivo <- paste0('img/bi/', x, 'X', y, '.pdf')
  ggsave(arquivo)
}
```
<!-- Colocar as funções prontas criadas, como usa-las, e os outputs dos gráficos. -->

**3.1.1. Estruturando dados para gráficos**

Colocar alguns exemplos das estruturas dos dados errados e como corrigi-los com base no que foi falado no tratamento de dados.

## 3.2. Tabelas de Frequência

Criar tabelas excel ou R pra colocar no overleaf.

## 3.3. Interpretação

Colocar exemplos de interpretação, como e quanto interpretar, dicas via exemplos para não escrever pouco e nem muito.

# 4. Overleaf

O básico do overleaf, as expressões, inserir imagens e tabelas.